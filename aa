import json
import boto3

def lambda_handler(event, context):
    bedrock_runtime = boto3.client(service_name='bedrock-runtime', region_name='us-east-1')

    model_id = 'amazon.nova-lite-v1:0'  # Novalite (Chatモデル)

    # ユーザー入力に「必ず日本語で答えてください」を付加
    user_message = {
        "role": "user",
        "content": [
            {"text": event.get("message", "") + "。必ず日本語で答えてください。"}
        ]
    }

    body = json.dumps({
        "messages": [user_message]
    })

    response = bedrock_runtime.invoke_model(body=body, modelId=model_id)
    response_body = json.loads(response.get('body').read())

    # 出力テキストを抽出
    output_text = response_body["output"]["message"]["content"][0]["text"]

    return {
        'statusCode': 200,
        'headers': {"Content-Type": "application/json"},
        'body': json.dumps({
            "message": output_text
        })
    }


Allow: bedrock:InvokeModel
Allow: bedrock:InvokeModelWithResponseStream
Allow: bedrock:ListFoundationModels
Allow: logs:CreateLogStream
Allow: logs:PutLogEvents
Allow: logs:CreateLogGroup
